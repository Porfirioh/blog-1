<?php//// Контроллер страницы чтения.//class C_Users extends C_Base{	private $model;    function __construct()    {        parent::__construct();        $this->model = M_Users::instance();    }	public function action_index(){	}    public function action_login(){        if (isset($_POST['login']) && isset($_POST['password'])){            $auth_result = $this->model->login($_POST['login'], $_POST['password'], isset($_POST['remember']));            if ($auth_result == ''){                header('Location: index.php');                exit();            } else{                $this->error_msg = $auth_result;            }        }    }    public function action_reg(){        if (isset($_POST['login']) && isset($_POST['password'])){            $reg_result = $this->model->registration($_POST['name'], $_POST['login'], $_POST['password'], $_POST['repeated_password']);            if ($reg_result == ''){                $this->action_login();            } else{                $this->error_msg = $reg_result;            }        }    }    public function action_logout(){        $this->model->logout();        header('Location: index.php');    }	public function action_read(){		$id = $_REQUEST['id'];		$article = $this->model->getRecord($id);		//если статьи с заданным id нет, уходим к списку статей		if (count($article) == 0){            header('Location: index.php');            exit();		}        if (isset($_POST['author']) && isset($_POST['content'])){            if (($_POST['author'] != '') && ($_POST['content'] != '')){                $this->comments_model->addRecord($_POST['author'], $_POST['content'], $id);            }        }        $comments = $this->comments_model->getAllRecords($id);		$this->title .= $article[0]['title'];		$article_content = $article[0]['content'];		//Страница, с которой пришли		$page = isset($_REQUEST['page']) ? (int) $_REQUEST['page'] : 1;        $this->menu = array('К списку статей' => "index.php?page=$page");		$this->content = $this->template('v/v_article.php', array('page' => $page, 'article' => $article_content,                                                                  'article_id' => $id, 'comments' => $comments));	}		public function action_show_editor(){		$this->title .= 'Редактор статей';        $this->menu = array('Добавить статью' => 'index.php?act=add',                            'На главную' => 'index.php');		$articles = $this->model->getAllRecords();		$this->content = $this->template('v/v_edit_articles.php', array('articles' => $articles));	}	public function action_edit(){						if (isset($_POST['title']) && isset($_POST['content']) && isset($_GET['id'])){			if ($_POST['title'] != "" && $_POST['content'] != ""){                if (!$this->model->editRecord($_GET['id'], $_POST['title'], $_POST['content'])){					//фиксируем ошибку				}			}				header('Location: index.php?act=show_editor');			exit();		}				//Если не пришел id статьи, перенаправляем пользователя к админке		if (!isset($_GET['id'])){			header('Location: index.php?act=show_editor');			exit();			}		$this->title .= '::Редактирование';		$article = $this->model->getRecord($_GET['id']);		$this->content = $this->template('v/v_edit_article.php', array('article_title' => $article[0]['title'],														  			   'article_content' => $article[0]['content'],														               'article_id' => (int) $_GET['id']));;			}	public function action_delete(){		if (isset($_GET['id'])) {				if (!$this->model->deleteRecord($_GET['id'])){				//фиксируем ошибку			}			} 		header('Location: index.php?act=show_editor');		}	public function action_add(){				if (isset($_POST['title']) && isset($_POST['content'])){			if ($_POST['title'] != "" && $_POST['content'] != ""){				if (!$this->model->addRecord($_POST['title'], $_POST['content'])){					//фиксируем ошибку				}			}				header('Location: index.php?act=show_editor');			exit();		}			$this->title .= 'Новая статья';		$this->content = $this->template('v/v_add_article.php', array());	}}